const validForm = document.getElementById("confirmercommande");
const forms = document.getElementsByClassName('needs-validation');
let validation = Array.prototype.filter.call(forms, function (form) {
    validForm.addEventListener('click', function (event) {
        if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
        } else {
            addPanier();
            if (localStorage.getItem("products") != null && localStorage.getItem("ours") != null) {
                validForm.innerHTML = `Veuillez patienter ....`
                const data = {
                    contact: {
                        firstName: contact.prenom,
                        lastName: contact.nom,
                        address: contact.adresse,
                        city: contact.ville,
                        email: contact.email
                    },
                    products
                };
                (async () => {
                    const Response = await fetch('http://localhost:3000/api/teddies/order', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    const content = await Response.json();
                    console.log(content);
                    console.log(Response);
                    window.setTimeout(function () {
                        window.location = `validation.html?id=${content.orderId}&price=${prixFinaladd}&user=${prenom.value}`, localStorage.removeItem('ours'); // replace
                        localStorage.clear();
                    }, 2000)
                })();
            }
        }
        form.classList.add('was-validated');

    }, false);
});
false





function verifPanier (){
    if (localStorage.getItem("ours") === null) {            
        document.location.replace = `panierVide.html`                 // redirection sur panier vide en cas de valeur null sur l'item ours du local-storage
    } else {
        document.location.replace = `panier.html`                     // sinon envoi du lien panier.html
    }
}

panier.addEventListener("click", event => {                 // verification du panier 
    verifPanier ()
})